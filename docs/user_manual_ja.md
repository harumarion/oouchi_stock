# 買い物予報 取扱説明書

買い物予報は、ご家庭の在庫を管理し、買い物予報を提供するアプリです。セール情報と在庫状況から買っておくべき商品を予測します。以下では画面ごとの操作方法をご説明します。
本アプリは Material Design 3 を採用しており、スマートフォンでの利用に最適化された最新のUIを提供します。画面の文字には Google Fonts の **Roboto** を使用しており、可読性を高めています。
タブバーも白を基調としたテーマに統一しており、選択中と非選択中で文字色が変わります。
なお、広告表示機能には `google_mobile_ads` パッケージのバージョン 4.0.0 以上が必要です。
また、動作させるには AndroidManifest と iOS の Info.plist にそれぞれ有効な AdMob の
App ID を設定しておく必要があります。テスト用途であればサンプル ID を利用できます。
また、AndroidManifest.xml を編集する際は XML 形式を崩さないよう注意し、コメントはタグの外側に記述してください。

## ログイン
- 初回起動時にログイン画面が表示されます。
- ローカライズが読み込まれるまで数秒かかる場合は、読み込み中の画面が表示されます。
- 「匿名で続行」を選ぶと端末のみでデータを管理します。
- Google アカウントでログインすると他の端末とデータを共有できます。
- ログインできない場合や `CONFIGURATION_NOT_FOUND` エラーが表示される場合は
  Firebase コンソールで匿名認証が有効になっているか確認してください。また、
  端末の Google Play サービスが古い場合や
  インストールされていない場合はログインに失敗することがあります。
  その際は Google Play サービスを更新するか、対応端末でお試しください。
- ログイン画面で使用される Firebase の言語は端末の表示言語に合わせて自動で設定されます。
- オフライン状態でログインを試みると「ログインに失敗しました」と表示されます。ネットワーク接続を確認してください。

 -## ホーム画面
 - アプリを起動すると買い物予報リストが表示されます。自動判定で追加された商品がカテゴリごとにタブ分けされ、残り日数とともに一覧されます。
- 起動処理中はローディング画面が表示されます。
- オフラインでも起動し、最後に取得したデータを表示します。接続が復旧すると自動的に同期されます。
- オフライン時でも在庫数量の更新が可能で、次回オンライン接続時に履歴を含め同期されます。
- ネットワークの接続状態が変わると、画面下部にオンライン/オフラインのメッセージが表示されます。言語設定が完了してから通知されるため、起動直後は数秒遅れて表示される場合があります。
- 画面下部のメニューバーから各機能に移動できます。左から「買い物リスト」「在庫一覧」「買い物予報」「セール情報」の順に並んでいます。

## 在庫一覧画面
- 下部メニューの「在庫一覧」から移動するとカテゴリごとのタブに在庫が表示されます。
- 在庫カードの📦ボタンで在庫数量を直接入力、✂️ボタンで使用量を入力、ショッピングカートボタンで購入量を入力できます。
- 在庫カードをタップすると詳細画面に移動します。長押しすると編集や削除ができます。
- 数量の変更は履歴として自動記録され、あとから確認できます。
- 画面上部の検索バーでは商品名だけでなくカテゴリ名や品種名でも検索できます。並び替えドロップダウンから「あいうえお順」または「最終更新順」を選択できます。
- 画面を開き直すたびに最新のカテゴリ情報を取得して表示します。
- 品種名や商品名が長い場合は、カード表示後3秒で自動的に横スクロールし、最後まで表示したら元の位置に戻ります。
- 画面右下の「＋」ボタンから商品追加画面を開けます。

## 商品追加画面
- 在庫一覧画面右下の「＋」ボタンから表示されます。
- 商品名、カテゴリ、品種、数量、単位、メモを入力して保存します。
- カテゴリが登録されていない場合は「カテゴリが登録されていません」と表示され、カテゴリ追加ボタンが表示されます。
- 数量は画面中央の + / - ボタンで1単位ずつ調整できます。
- 必須項目が未入力の場合はエラーが表示されます。
- ルート画面から開いた場合、保存しても画面遷移せずフォームが初期化されます。
- 画面右上のメニューから設定画面やセール情報管理画面に移動できます。

## 商品詳細画面
- 在庫カードをタップすると表示されます。
- 画面左側に項目名、右側に内容が並ぶ表形式で詳細を確認できます。文字サイズは他の画面より大きめです。
- 履歴は操作日時、操作種別、操作前→操作後の数量(増減量)の順で表示され、各行は薄いグレーの線で区切られ、カテゴリと同じ文字サイズで表示されます。
- 画面右上の編集アイコンから商品情報を編集できます。
- 月あたりの消費量と残り日数が計算され表示されます。

## 商品編集画面
- 商品詳細画面や在庫カードの長押しメニューから移動します。
- 商品名、カテゴリ、品種、単位、メモを変更して保存します。
- カテゴリや品種リストはデータベースの更新に合わせて自動で更新されます。
- 品種が未登録のカテゴリを選ぶと、自動的に「その他」が選択されます。

## セール情報管理画面
- メニューの「セール情報管理」から表示されます。
- カテゴリごとに登録したセール情報をカード形式で一覧表示します。各カードには品種、商品名、期限、通常価格、セール価格、そしてその差額が表示されます。
- 画面右下の「＋」ボタンでセール情報を追加できます。
- 各タブの上部に検索バーがあり、商品名だけでなくカテゴリ名や品種名でも絞り込みできます。並び替えは「あいうえお順」「最終更新順」「単価順」から選択できます。
- 期限切れから1日経過した情報は非表示になりますが、画面上の「期限切れも表示」スイッチをオンにすると過去の情報も確認できます。
- 画面右上のメニューから設定画面を開けます。

## セール情報履歴画面
- セール情報管理画面で商品種別をタップすると表示されます。
- 過去の購入履歴が一覧表示され、長押しで削除できます。
- 各履歴の詳細は、項目が左、内容が右に並ぶ形式で表示されます。
- 詳細テキストは他の画面より大きな文字サイズ(18px)で表示されます。

- 履歴の文字サイズはカテゴリ表示と統一されています。
## セール情報一覧画面
- 下部メニューの「買い得リスト」から表示されます。
- 各カードには商品名、店舗名、セール価格、通常価格、期間、残り日数、在庫が表示されます。
- フィルターチップで終了日が近い順、割引率順、単価安い順、おすすめ順に並び替えできます。
- 画面右上のスイッチでセール通知のオン/オフを切り替えられます。
- スワイプ操作で削除や買い物リスト追加が可能です。
- 期限が近いセールは赤字で表示されます。

## セール情報追加画面
- セール情報管理画面の「＋」ボタンで表示されます。
- 商品、数量、合計容量、通常価格、セール価格、購入店舗、承認ページURL、メモを入力して保存します。確認日は保存時の日時が自動で登録されます。
- 在庫が登録されていない場合は、商品追加ボタンが表示されます。
- 入力した数量と合計容量から単価が自動計算され、画面下部に大きな文字で表示されます。
- 数量・合計容量・価格は0以上の数値を入力する必要があります。誤った値を入力するとエラーが表示されます。

## 買い物リスト画面
- ホーム画面に表示されるリストです。
- 残量がしきい値以下の商品が一覧表示されます。買うものがなければメッセージが表示されます。
- カテゴリによる色分けやタブはなく、すべてのアイテムが一覧表示されます。
- 毎週金曜日18時に買い物リストの通知が届きます。
- 画面を開くたびに最新の情報を取得してリストを更新します。
- 画面上部の入力欄から手動で商品名を追加できます。
- リストの各項目には現在の在庫数と予測される残り日数が表示されます。
- 在庫一覧やセール情報、買い物予報画面の各カードに「買い物リストに追加」ボタンがあります。
  追加した商品は元の在庫データへのリンク付きで買い物リストに表示されます。
- カードを右にスワイプすると削除できます。削除時に購入数を入力して在庫を増やせます。
- 削除時に入力した数量は在庫一覧にも即座に反映されます。

## 自動判定ロジック
- 在庫ゼロなら価格に関係なく買い物リストへ自動追加
- 在庫がしきい値以下で価格が高い場合は買い物予報リストへ
- 在庫十分でセール中なら買い物予報リストへ自動追加
- 在庫少でセール中なら買い物リストへ自動追加
自動判定はアプリ起動時に実行され、最新の在庫と価格情報からリストを更新します。

## 設定画面
設定メニューから表示されます。
- 「カテゴリ設定」からカテゴリの追加・編集・削除が行えます。
- 「言語」から表示言語を英語または日本語に変更できます。
- 「言語」から表示言語を英語または日本語に変更できます。この操作で Firebase の認証言語も同時に切り替わります。
- 「買い物予報条件設定」では、買い物リストに表示する条件を次の3種類から選べます。
  - 在庫数が指定したしきい値以下になったら表示
  - 予測購入日が指定日数以内になったら表示
  - しきい値または日数のどちらかを満たしたら表示
- 広告表示スイッチでバナー広告の表示有無を切り替えられます。
- バナー広告の高さは画面下部メニューと同じです。
- 「バックアップ」をタップすると確認ダイアログが表示されます。実行すると端末にデータと日時が保存されます。
- 「復元」をタップすると保存日時を含む確認ダイアログが表示され、その日時のデータを復元します。
  バックアップボタンの右側には最後にバックアップした日時が表示されます。
  初回や未実行の場合は「未バックアップ」と表示されます。
  復元ボタンの右側には復元したデータの日時が表示されます。
  こちらも未実行の場合は「未復元」と表示されます。

## カテゴリ設定画面
- 現在登録されているカテゴリを一覧表示します。
- 各カテゴリを長押しすると編集や削除ができます。
- 画面右下の「＋」ボタンからカテゴリを追加できます。
- 並び順を変更する場合は、カテゴリを長押しして「並び替え」を選択します。
  並び替え画面で戻るボタンを押した場合も変更は自動的に保存され、
  買い物予報や買い物リストなどの表示順にも反映されます。
- 各カテゴリの色をタップして変更できます。未設定の場合は灰色で表示されます。

## 品種設定画面
- 各カテゴリごとにタブが分かれており、品種を一覧表示します。
- リストには品種名のみが表示され、カテゴリ名はタブで確認します。
- 品種を長押しすると編集や削除ができます。
- 画面右下の「＋」ボタンから品種を追加できます。

以上で買い物予報の基本的な操作は完了です。ぜひご活用ください。
